<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exnova Trading Bot - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900 text-gray-200 font-sans p-6">

    <div class="max-w-7xl mx-auto space-y-6">

        <header class="flex justify-between items-center pb-4 border-b border-gray-700">
            <div>
                <h1 class="text-2xl font-semibold text-white">Panel Principal</h1>
                <p class="text-gray-400 text-sm">Resumen de la actividad y control del bot</p>
            </div>
            <div class="flex items-center space-x-2 text-sm text-gray-400">
                <span class="inline-block w-2.5 h-2.5 rounded-full shadow-md 
                    {% if data.bot_active %}bg-green-500 shadow-green-500/50{% else %}bg-red-500 shadow-red-500/50{% endif %}"></span>
                <span class="font-semibold text-white">Bot {{ 'Activo' if data.bot_active else 'Inactivo' }}</span>
                <a href="/configuracion" class="text-gray-400 hover:text-white transition-colors duration-200 ml-4">锔 Configuraci贸n</a>
            </div>
        </header>

        <div class="flex bg-gray-800 p-1 rounded-lg">
            <a href="/" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium text-center
                {% if request.path == '/' %}bg-green-500 text-white shadow-lg shadow-green-500/30{% else %}text-gray-400 hover:text-white transition-colors duration-200{% endif %}">
                Dashboard
            </a>
            <a href="/configuracion" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium text-center
                {% if request.path == '/configuracion' %}bg-green-500 text-white shadow-lg shadow-green-500/30{% else %}text-gray-400 hover:text-white transition-colors duration-200{% endif %}">
                Configuraci贸n
            </a>
            <a href="/history" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium text-center
                {% if request.path.startswith('/history') %}bg-green-500 text-white shadow-lg shadow-green-500/30{% else %}text-gray-400 hover:text-white transition-colors duration-200{% endif %}">
                Historial
            </a>
            <a href="/cuenta" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium text-center
                {% if request.path == '/cuenta' %}bg-green-500 text-white shadow-lg shadow-green-500/30{% else %}text-gray-400 hover:text-white transition-colors duration-200{% endif %}">
                Cuenta
            </a>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

            <div class="bg-gray-800 p-6 rounded-xl shadow-lg md:col-span-1 space-y-4">
                <h2 class="text-xl font-bold text-white flex items-center">
                    <span class="w-3 h-3 mr-2 rounded-full 
                        {% if data.bot_active %}bg-green-500 animate-pulse{% else %}bg-red-500{% endif %}"></span>
                    Control del Bot
                </h2>
                <p class="text-2xl font-extrabold text-white">{{ data.total_balance }}</p>
                <p class="text-sm text-gray-400">Balance Actual</p>
                
                <form method="POST" action="{{ url_for('toggle') }}">
                    <button type="submit" class="w-full py-3 rounded-lg text-white font-semibold transition-colors duration-200 
                        {% if data.bot_active %}bg-red-600 hover:bg-red-700{% else %}bg-green-600 hover:bg-green-700{% endif %}">
                        {{ 'DESACTIVAR' if data.bot_active else 'ACTIVAR BOT' }}
                    </button>
                </form>

                <div class="pt-4 border-t border-gray-700 space-y-2">
                    <p class="text-sm font-medium text-gray-300">Estado: <span class="text-gray-400">{{ data.bot_status }}</span></p>
                    <p class="text-sm font-medium text-gray-300">Pr贸x. Entrada: <span class="text-white">{{ data.next_operation_time }} ({{ data.next_operation_pair }})</span></p>
                </div>
            </div>

            <div class="bg-gray-800 p-6 rounded-xl shadow-lg md:col-span-2 grid grid-cols-4 gap-4">
                
                <div class="col-span-1 text-center bg-gray-700 p-3 rounded-lg">
                    <p class="text-3xl font-extrabold 
                        {% if data.success_rate >= 70 %}text-green-500{% else %}text-yellow-500{% endif %}">
                        {{ data.success_rate }}%
                    </p>
                    <p class="text-xs text-gray-400 mt-1">Efectividad (Hoy)</p>
                </div>

                <div class="col-span-1 text-center bg-gray-700 p-3 rounded-lg">
                    <p class="text-3xl font-extrabold text-white">{{ data.operations_today }}</p>
                    <p class="text-xs text-gray-400 mt-1">Operaciones</p>
                </div>

                <div class="col-span-1 text-center bg-gray-700 p-3 rounded-lg">
                    <p class="text-3xl font-extrabold text-green-500">{{ data.wins_today }}</p>
                    <p class="text-xs text-gray-400 mt-1">Ganadas</p>
                </div>

                <div class="col-span-1 text-center bg-gray-700 p-3 rounded-lg">
                    <p class="text-3xl font-extrabold text-red-500">{{ data.losses_today }}</p>
                    <p class="text-xs text-gray-400 mt-1">Perdidas</p>
                </div>

                <div class="col-span-4 pt-4 border-t border-gray-700">
                    <h3 class="text-lg font-semibold text-white mb-3">Entrada Manual (Override)</h3>
                    <form method="POST" action="{{ url_for('execute_manual_entry') }}" class="flex items-end space-x-3">
                        
                        <div class="flex-1">
                            <label for="pair" class="block text-xs font-medium text-gray-400 mb-1">Par</label>
                            <select id="pair" name="pair" required class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-sm text-white focus:ring-green-500 focus:border-green-500">
                                <option value="EUR/USD">EUR/USD</option>
                                <option value="GBP/USD">GBP/USD</option>
                                <option value="USD/JPY">USD/JPY</option>
                            </select>
                        </div>
                        
                        <div class="flex-1">
                            <label for="entry_type" class="block text-xs font-medium text-gray-400 mb-1">Tipo</label>
                            <select id="entry_type" name="entry_type" required class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-sm text-white focus:ring-green-500 focus:border-green-500">
                                <option value="CALL">CALL (Sube) </option>
                                <option value="PUT">PUT (Baja) </option>
                            </select>
                        </div>

                        <div class="w-24">
                            <label for="amount" class="block text-xs font-medium text-gray-400 mb-1">Monto ($)</label>
                            <input type="number" id="amount" name="amount" value="{{ bot.default_amount }}" step="0.01" required 
                                class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-sm text-white focus:ring-green-500 focus:border-green-500">
                        </div>
                        
                        <div class="w-24">
                            <label for="duration" class="block text-xs font-medium text-gray-400 mb-1">Duraci贸n</label>
                            <select id="duration" name="duration" required class="w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-sm text-white focus:ring-green-500 focus:border-green-500">
                                <option value="1m">1m</option>
                                <option value="5m" selected>5m</option>
                                <option value="15m">15m</option>
                            </select>
                        </div>

                        <button type="submit" class="py-2 px-4 bg-yellow-600 hover:bg-yellow-700 text-white rounded-md font-semibold text-sm transition-colors duration-200 h-[42px]">
                            Ejecutar
                        </button>
                    </form>
                    <p class="text-xs text-gray-500 mt-2">Usar solo para pruebas o entradas manuales urgentes. El bot debe estar activo para ejecutar.</p>
                </div>
            </div>

        </div>

        <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold text-white mb-4">ltimas Operaciones (Hoy)</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr class="text-sm text-gray-400 border-b border-gray-700">
                            <th class="px-4 py-2 text-left">ID</th>
                            <th class="px-4 py-2 text-left">Hora</th>
                            <th class="px-4 py-2 text-left">Par</th>
                            <th class="px-4 py-2 text-left">Tipo</th>
                            <th class="px-4 py-2 text-left">Monto</th>
                            <th class="px-4 py-2 text-left">Duraci贸n</th>
                            <th class="px-4 py-2 text-left">Resultado</th>
                            <th class="px-4 py-2 text-right">Ganancia/P茅rdida</th>
                        </tr>
                    </thead>
                    <tbody class="text-sm font-medium">
                        {% for op in data.last_operations %}
                        <tr class="border-b border-gray-700 last:border-b-0">
                            <td class="px-4 py-4">{{ op.id }}</td>
                            <td class="px-4 py-4">{{ op.time }}</td>
                            <td class="px-4 py-4">{{ op.pair }}</td>
                            <td class="px-4 py-4">
                                <span class="py-1 px-2 rounded-lg text-xs font-semibold
                                    {% if op.type == 'CALL' %}bg-green-500 text-white{% else %}bg-red-500 text-white{% endif %}">
                                    {{ op.type }}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-white font-semibold">${{ op.amount | round(2) }}</td>
                            <td class="px-4 py-4">{{ op.duration }}</td>
                            <td class="px-4 py-4">
                                <span class="font-semibold
                                    {% if op.result == 'WIN' %}text-green-500{% else %}text-red-500{% endif %}">
                                    {{ op.result }}
                                </span>
                            </td>
                            <td class="px-4 py-4 text-right font-semibold
                                {% if op.profit >= 0 %}text-green-500{% else %}text-red-500{% endif %}">
                                ${{ op.profit | round(2) }}
                            </td>
                        </tr>
                        {% endfor %}
                        {% if not data.last_operations %}
                        <tr>
                            <td colspan="8" class="px-4 py-4 text-center text-gray-500">No hay operaciones registradas para hoy.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</body>
</html>